<script setup lang="ts">
/**
 *
 <g-capacity-progress :total="row.totalSpace" :used="row.usedSpace">
    {{ proxy.formatBytes(row.usedSpace) }} / {{ proxy.formatBytes(row.totalSpace) }}
  </g-capacity-progress>
 */

import { ref, getCurrentInstance, computed } from 'vue'
const { proxy } = getCurrentInstance()
const progressBoxRef = ref(null)
const props = defineProps({
  total: {
    type: [String, Number],
    required: true,
  },
  used: {
    type: [String, Number],
    required: true,
  },
})
function format() {
  return `${percentage.value}%`
}
const percentage = computed(() => {
  let divideNum = Number((props.used || 0) / (props.total || 0)) * 100 ?? 0
  if (isNaN(divideNum)) {
    return 0
  }
  let percentRes = Number(divideNum.toFixed(2))
  return percentRes
})
function formatColor(value) {
  if (value < 90) {
    return 'green'
  } else {
    return 'red'
  }
}

const progressWidth = computed(() => {
  if (progressBoxRef.value) {
    let width = `${progressBoxRef.value.$el.offsetWidth - 30}px`
    return width
  } else {
    return '200px'
  }
})
</script>

<template>
  <div class="f-st-ct w-100%">
    <o-progress
      ref="progressBoxRef"
      class="progress-box"
      :percentage="percentage"
      type="line"
      :stroke-width="20"
      text-inside
      :format="format"
      :color="formatColor"
    >
      <template #default="{ percentage }">
        <div class="f-bt-ct" :style="{ width: progressWidth }">
          <div class="percentage-value">{{ format() }}</div>
          <div class="mr">
            <slot />
          </div>
        </div>
      </template>
    </o-progress>
    <o-icon v-if="percentage > 100" name="warning" content="已用容量远超总容量, 请扩容 " class="ml" />
  </div>
</template>

<style lang="scss" scoped>
.progress-box :deep(.el-progress-bar__outer) {
  background: #ccc;
}
</style>
